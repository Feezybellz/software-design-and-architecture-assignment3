<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Order</title>
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/MaterialDesign-Webfont/5.3.45/css/materialdesignicons.css"
        integrity="sha256-NAxhqDvtY0l4xn+YVa6WjAcmd94NNfttjNsDmNatFVc=" crossorigin="anonymous" />
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/boxicons/2.1.0/css/boxicons.min.css"
        integrity="sha512-pVCM5+SN2+qwj36KonHToF2p1oIvoU3bsqxphdOIWMYmgr4ZqD3t5DjKvvetKhXGc/ZG5REYTT6ltKfExEei/Q=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
</head>
<style>
    .card-footer-btn {
        display: flex;
        align-items: center;
        border-top-left-radius: 0 !important;
        border-top-right-radius: 0 !important;
    }

    .text-uppercase-bold-sm {
        text-transform: uppercase !important;
        font-weight: 500 !important;
        letter-spacing: 2px !important;
        font-size: .85rem !important;
    }

    .hover-lift-light {
        transition: box-shadow .25s ease, transform .25s ease, color .25s ease, background-color .15s ease-in;
    }

    .justify-content-center {
        justify-content: center !important;
    }

    .btn-group-lg>.btn,
    .btn-lg {
        padding: 0.8rem 1.85rem;
        font-size: 1.1rem;
        border-radius: 0.3rem;
    }

    .btn-dark {
        color: #fff;
        background-color: #1e2e50;
        border-color: #1e2e50;
    }

    .card {
        position: relative;
        display: flex;
        flex-direction: column;
        min-width: 0;
        word-wrap: break-word;
        background-color: #fff;
        background-clip: border-box;
        border: 1px solid rgba(30, 46, 80, .09);
        border-radius: 0.25rem;
        box-shadow: 0 20px 27px 0 rgb(0 0 0 / 5%);
    }

    .p-5 {
        padding: 3rem !important;
    }

    .card-body {
        flex: 1 1 auto;
        padding: 1.5rem 1.5rem;
    }

    tbody,
    td,
    tfoot,
    th,
    thead,
    tr {
        border-color: inherit;
        border-style: solid;
        border-width: 0;
    }

    .table td,
    .table th {
        border-bottom: 0;
        border-top: 1px solid #edf2f9;
    }

    .table>:not(caption)>*>* {
        padding: 1rem 1rem;
        background-color: var(--bs-table-bg);
        border-bottom-width: 1px;
        box-shadow: inset 0 0 0 9999px var(--bs-table-accent-bg);
    }

    .px-0 {
        padding-right: 0 !important;
        padding-left: 0 !important;
    }

    .table thead th,
    tbody td,
    tbody th {
        vertical-align: middle;
    }

    tbody,
    td,
    tfoot,
    th,
    thead,
    tr {
        border-color: inherit;
        border-style: solid;
        border-width: 0;
    }

    .mt-5 {
        margin-top: 3rem !important;
    }

    .icon-circle[class*=text-] [fill]:not([fill=none]),
    .icon-circle[class*=text-] svg:not([fill=none]),
    .svg-icon[class*=text-] [fill]:not([fill=none]),
    .svg-icon[class*=text-] svg:not([fill=none]) {
        fill: currentColor !important;
    }

    .svg-icon>svg {
        width: 1.45rem;
        height: 1.45rem;
    }

    #shippingEmail{
        text-decoration: none;
        color: #1e2e50;
    }
</style>

<body>
    <div class="container">
        <header class="d-flex flex-wrap align-items-center justify-content-center justify-content-md-between py-3">
            <div class="col-md-3 mb-md-0">
                <a href="/" class="d-inline-flex link-body-emphasis text-decoration-none">
                    <img src="/images/logo.png" style="width: 80px;" alt="">
                    <use xlink:href="#bootstrap"></use>
                    </svg>
                </a>
            </div>
            <ul class="nav col-12 col-md-auto mb-2 justify-content-center mb-md-0">
                <li><a href="/" class="nav-link px-2 link-secondary">Home</a></li>
                <li><a href="/cart" class="nav-link px-2">Cart</a></li>
                <li><a href="/orders" class="nav-link px-2">Orders</a></li>
            </ul>
            <auth-buttons></auth-buttons>

        </header>
    </div>
    <div class="container mt-6 mb-7">
        <div class="row justify-content-center">
            <div class="col-lg-12 col-xl-7">
                <div class="card">
                    <div class="card-body">

                        <div class="border-gray-200 pt-4 mt-4">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="text-muted mb-2">Order Id</div>
                                    <strong id="orderId"></strong>
                                </div>
                                <div class="col-md-6 text-md-end">
                                    <div class="text-muted mb-2">Order Date:</div>
                                    <strong id="orderDate">Feb/09/20</strong>
                                    <div class="text-muted mb-2 mt-2">Status:</div>
                                    <strong id="orderStatus" class="badge bg-primary"></strong>
                                </div>
                            </div>
                        </div>

                        <div class="border-top border-gray-200 mt-4 py-4">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="text-muted mb-2">Customer Name</div>
                                    <strong id="name">
                                        
                                    </strong>
                                    <p class="fs-sm" id="address">
                                        
                                        <br>
                                    </p>
                                    <a href="#" class="text-purple" id="shippingEmail">
                                    </a>
                                </div>
                            </div>
                        </div>

                        <table class="table border-bottom border-gray-200 mt-3">
                            <thead>
                                <tr>
                                    <th scope="col" class="fs-sm text-dark text-uppercase-bold-sm px-0">Product x
                                        Quantity</th>
                                    <th scope="col" class="fs-sm text-dark text-uppercase-bold-sm text-end px-0">Amount
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="productsRows">
                            </tbody>
                        </table>

                        <div class="mt-5">
                            <div class="d-flex justify-content-end mt-3">
                                <h5 class="me-3">Total:</h5>
                                <h5 class="text-success" id="total">$399.99 USD</h5>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
    crossorigin="anonymous"></script>

<script src="/js/elements.js"></script>

<script>
    function fetchAndRenderOrder() {
        const pathname = window.location.pathname;
        const segments = pathname.split('/');
        const orderId = segments[segments.length - 1];

        if (!orderId) {
            alert("Order ID is missing in the URL.");
            return;
        }

        fetch(`/api/orders/${orderId}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error("Network response was not ok");
                }
                return response.json();
            })
            .then(order => {
                console.log(order);

                document.getElementById('orderId').innerText = order._id;
                document.getElementById('orderDate').innerText = new Date(order.createdAt).toLocaleDateString();
                
                // Set order status with appropriate color
                const statusElement = document.getElementById('orderStatus');
                statusElement.innerText = order.status;
                statusElement.className = 'badge '; // Reset classes
                
                // Add appropriate background color based on status
                switch(order.status.toLowerCase()) {
                    case 'processing':
                        statusElement.classList.add('bg-warning');
                        break;
                    case 'shipped':
                        statusElement.classList.add('bg-info');
                        break;
                    case 'delivered':
                        statusElement.classList.add('bg-success');
                        break;
                    case 'cancelled':
                        statusElement.classList.add('bg-danger');
                        break;
                    default:
                        statusElement.classList.add('bg-primary');
                }

                document.getElementById('name').innerText = order.shippingInfo.name;
                document.getElementById('address').innerText = `${order.shippingInfo.address}, ${order.shippingInfo.city}, ${order.shippingInfo.postalCode}`;
                document.getElementById('shippingEmail').innerText = order.shippingInfo.email;
                // console.log(order.shippingInfo.email);
                

                const productsRows = document.getElementById('productsRows');
                productsRows.innerHTML = '';
                order.items.forEach(product => {
                    console.log(product);
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `<td class="px-0">${product.quantity} x ${product.name} @ ${product.price.toFixed(2)}</td>
                                         <td class="text-end px-0">$${(product.price * product.quantity).toFixed(2)}</td>`;
                    productsRows.appendChild(row);
                });

                document.getElementById('total').innerText = `$${order.total.toFixed(2)}`;
            })
            .catch(error => {
                console.error("Error fetching order:", error);
                alert("Failed to load order details. Please try again later.");
            });
    }

    fetchAndRenderOrder();
</script>

</html>